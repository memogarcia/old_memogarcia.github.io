---
layout: post
title:  "SSH"
date:   2015-06-09 21:00:00
categories: linux ssh
---

## SSH SCP

# Public key authentication

{% highlight bash %}

ssh-keygen -t dsa -N ''
cat ~/.ssh/id_dsa.pub | ssh you@host-server "cat - >> ~/.ssh/authorized_keys2"

{% endhighlight %}


# Check fingerprint

{% highlight bash %}

ssh-keygen -l -f /etc/ssh/ssh_host_rsa_key.pub      # For RSA key
2048 61:33:be:9b:ae:6c:36:31:fd:83:98:b7:99:2d:9f:cd /etc/ssh/ssh_host_rsa_key.pub
ssh-keygen -l -f /etc/ssh/ssh_host_dsa_key.pub      # For DSA key (default)
2048 14:4a:aa:d9:73:25:46:6d:0a:48:35:c7:f4:16:d4:ee /etc/ssh/ssh_host_dsa_key.pub

{% endhighlight %}


# Secure file transfer (SFT)

{% highlight bash %}

scp file.txt host-two:/tmp
scp joe@host-two:/www/*.html /www/tmp
scp -r joe@host-two:/www /www/tmp

{% endhighlight %}


# Tunneling

SSH tunneling allows to forward or reverse forward a port over the SSH connection, thus securing the traffic and accessing ports which would otherwise be blocked. This only works with TCP. The general nomenclature for forward and reverse is:

{% highlight bash %}

ssh -L localport:desthost:destport user@gate  # desthost as seen from the gate
ssh -R destport:desthost:localport user@gate  # forwards your localport to destination
    # desthost:localport as seen from the client initiating the tunnel
ssh -X user@gate   # To force X forwarding

{% endhighlight %}

This will connect to gate and forward the local port to the host desthost:destport. Note desthost is the destination host as seen by the gate, so if the connection is to the gate, then desthost is localhost. More than one port forward is possible.
Direct forward on the gate

Let say we want to access the CVS (port 2401) and http (port 80) which are running on the gate. This is the simplest example, desthost is thus localhost, and we use the port 8080 locally instead of 80 so we don't need to be root. Once the ssh session is open, both services are accessible on the local ports.

{% highlight bash %}
ssh -L 2401:localhost:2401 -L 8080:localhost:80 user@gate
{% endhighlight %}
